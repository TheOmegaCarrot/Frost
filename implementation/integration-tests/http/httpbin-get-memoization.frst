def host_env = getenv('HTTPBIN_HOST')
def host = if is_null(host_env): '127.0.0.1' else: host_env

def port_env = getenv('HTTPBIN_PORT')
def port_str = if is_null(port_env): '8080' else: port_env
def port = to_int(port_str)

def task = http.request({
  endpoint: {
    host: host,
    tls: false,
    port: port,
    path: '/uuid'
  },
  method: 'GET'
})

def first = task.get()
def second = task.get()

assert(first.ok, 'first get should succeed')
assert(second.ok, 'second get should succeed')
assert(first.response.code == 200, 'first status code')
assert(second.response.code == 200, 'second status code')

def first_json = parse_json(first.response.body)
def second_json = parse_json(second.response.body)
assert(first_json.uuid == second_json.uuid, 'task.get should return cached response')
